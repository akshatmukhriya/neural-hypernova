apiVersion: ray.io/v1
kind: RayJob
metadata:
  name: hypernova-gpu-surge
spec:
  # The Python surge: Demand 2 GPUs for the task
  entrypoint: |
    python -c "import ray; ray.init(); @ray.remote(num_gpus=1) def work(): import time; time.sleep(120); return 1; ray.get([work.remote() for _ in range(2)])"
  rayClusterSpec:
    rayVersion: '2.9.0'
    headGroupSpec:
      rayStartParams:
        dashboard-host: "0.0.0.0"
      template:
        spec:
          containers:
            - name: ray-head
              image: rayproject/ray:2.9.0-py310 
              resources:
                requests: { cpu: "200m", memory: "512Mi" }
                limits: { cpu: "1", memory: "2Gi" }
    workerGroupSpecs:
      - replicas: 1 # FORCE A START: This triggers Karpenter immediately
        minReplicas: 0
        maxReplicas: 5
        groupName: gpu-group
        rayStartParams: {}
        template:
          spec:
            runtimeClassName: nvidia 
            containers:
              - name: ray-worker
                image: rayproject/ray-ml:2.9.0-py310-gpu
                resources:
                  limits:
                    nvidia.com/gpu: 1
                    cpu: "2"
                    memory: "8Gi"
                  requests:
                    nvidia.com/gpu: 1
                    cpu: "1"
                    memory: "4Gi"